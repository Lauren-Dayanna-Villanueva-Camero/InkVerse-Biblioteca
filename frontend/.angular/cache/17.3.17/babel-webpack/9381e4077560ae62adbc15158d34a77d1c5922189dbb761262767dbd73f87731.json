{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/auth.service\";\nimport * as i2 from \"../../services/admin.service\";\nimport * as i3 from \"../../services/alert.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nconst _c0 = [\"prestamosTable\"];\nfunction AdminPrestamosComponent_div_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 27)(1, \"div\", 28)(2, \"span\", 29);\n    i0.ÉµÉµtext(3, \"Cargando...\");\n    i0.ÉµÉµelementEnd()()();\n  }\n}\nfunction AdminPrestamosComponent_div_43_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 27)(1, \"div\", 30)(2, \"h5\", 31);\n    i0.ÉµÉµtext(3, \"\\u26A0\\uFE0F No hay pr\\u00E9stamos registrados\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(4, \"p\");\n    i0.ÉµÉµtext(5, \"No se encontraron pr\\u00E9stamos en el sistema.\");\n    i0.ÉµÉµelementEnd()()();\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_span_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"span\", 44);\n    i0.ÉµÉµtext(1, \" Vencido \");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_span_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"span\", 20);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const prestamo_r1 = i0.ÉµÉµnextContext().$implicit;\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtextInterpolate1(\" \", prestamo_r1.diasRetraso, \" d\\u00EDas \");\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_span_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"span\", 5);\n    i0.ÉµÉµtext(1, \"-\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_strong_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"strong\", 45);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const prestamo_r1 = i0.ÉµÉµnextContext().$implicit;\n    const ctx_r1 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r1.formatearMoneda(prestamo_r1.valorMulta), \" \");\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_span_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"span\", 5);\n    i0.ÉµÉµtext(1, \"-\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_button_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"button\", 46);\n    i0.ÉµÉµlistener(\"click\", function AdminPrestamosComponent_div_44_tr_28_button_36_Template_button_click_0_listener() {\n      i0.ÉµÉµrestoreView(_r3);\n      const prestamo_r1 = i0.ÉµÉµnextContext().$implicit;\n      const ctx_r1 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r1.recibirLibro(prestamo_r1));\n    });\n    i0.ÉµÉµtext(1, \" \\uD83D\\uDCE5 Recibir \");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_button_37_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"button\", 47);\n    i0.ÉµÉµlistener(\"click\", function AdminPrestamosComponent_div_44_tr_28_button_37_Template_button_click_0_listener() {\n      i0.ÉµÉµrestoreView(_r4);\n      const prestamo_r1 = i0.ÉµÉµnextContext().$implicit;\n      const ctx_r1 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r1.pagarMulta(prestamo_r1));\n    });\n    i0.ÉµÉµtext(1, \" \\uD83D\\uDCB0 Pagar Multa \");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_span_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"span\", 5);\n    i0.ÉµÉµtext(1, \"-\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction AdminPrestamosComponent_div_44_tr_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"tr\")(1, \"td\");\n    i0.ÉµÉµtext(2);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(3, \"td\")(4, \"strong\");\n    i0.ÉµÉµtext(5);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelement(6, \"br\");\n    i0.ÉµÉµelementStart(7, \"small\", 5);\n    i0.ÉµÉµtext(8);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(9, \"td\")(10, \"strong\");\n    i0.ÉµÉµtext(11);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelement(12, \"br\");\n    i0.ÉµÉµelementStart(13, \"small\", 5);\n    i0.ÉµÉµtext(14);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(15, \"td\");\n    i0.ÉµÉµtext(16);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(17, \"td\");\n    i0.ÉµÉµtext(18);\n    i0.ÉµÉµtemplate(19, AdminPrestamosComponent_div_44_tr_28_span_19_Template, 2, 0, \"span\", 36);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(20, \"td\")(21, \"span\", 37);\n    i0.ÉµÉµtext(22);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(23, \"td\")(24, \"span\", 38);\n    i0.ÉµÉµtext(25);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(26, \"td\")(27, \"span\", 38);\n    i0.ÉµÉµtext(28);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(29, \"td\");\n    i0.ÉµÉµtemplate(30, AdminPrestamosComponent_div_44_tr_28_span_30_Template, 2, 1, \"span\", 39)(31, AdminPrestamosComponent_div_44_tr_28_span_31_Template, 2, 0, \"span\", 40);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(32, \"td\");\n    i0.ÉµÉµtemplate(33, AdminPrestamosComponent_div_44_tr_28_strong_33_Template, 2, 1, \"strong\", 41)(34, AdminPrestamosComponent_div_44_tr_28_span_34_Template, 2, 0, \"span\", 40);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(35, \"td\");\n    i0.ÉµÉµtemplate(36, AdminPrestamosComponent_div_44_tr_28_button_36_Template, 2, 0, \"button\", 42)(37, AdminPrestamosComponent_div_44_tr_28_button_37_Template, 2, 0, \"button\", 43)(38, AdminPrestamosComponent_div_44_tr_28_span_38_Template, 2, 0, \"span\", 40);\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const prestamo_r1 = ctx.$implicit;\n    const ctx_r1 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(prestamo_r1.id);\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµtextInterpolate2(\"\", prestamo_r1.usuario.nombre, \" \", prestamo_r1.usuario.apellido, \"\");\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµtextInterpolate(\"@\" + prestamo_r1.usuario.username);\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµtextInterpolate(prestamo_r1.libro.titulo);\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµtextInterpolate(prestamo_r1.libro.autor);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(ctx_r1.formatearFecha(prestamo_r1.fechaPrestamo));\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r1.formatearFecha(prestamo_r1.fechaLimite), \" \");\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r1.estaVencidoYEnPrestamo(prestamo_r1));\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r1.calcularDiasTranscurridos(prestamo_r1.fechaPrestamo), \" d\\u00EDas \");\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµproperty(\"ngClass\", ctx_r1.getDiasRestantesClass(prestamo_r1.fechaLimite));\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r1.calcularDiasRestantes(prestamo_r1.fechaLimite), \" d\\u00EDas \");\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµproperty(\"ngClass\", ctx_r1.getEstadoBadgeClass(prestamo_r1.estado));\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r1.getEstadoTexto(prestamo_r1.estado), \" \");\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r1.tieneDiasRetraso(prestamo_r1));\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµproperty(\"ngIf\", !ctx_r1.tieneDiasRetraso(prestamo_r1));\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r1.tieneMulta(prestamo_r1));\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµproperty(\"ngIf\", !ctx_r1.tieneMulta(prestamo_r1));\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµproperty(\"ngIf\", prestamo_r1.estado === \"PRESTADO\");\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµproperty(\"ngIf\", prestamo_r1.estado === \"MULTA\" && ctx_r1.tieneMulta(prestamo_r1));\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµproperty(\"ngIf\", prestamo_r1.estado === \"DEVUELTO\");\n  }\n}\nfunction AdminPrestamosComponent_div_44_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 32)(1, \"table\", 33, 0)(3, \"thead\", 34)(4, \"tr\")(5, \"th\");\n    i0.ÉµÉµtext(6, \"ID\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(7, \"th\");\n    i0.ÉµÉµtext(8, \"Usuario\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(9, \"th\");\n    i0.ÉµÉµtext(10, \"Libro\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(11, \"th\");\n    i0.ÉµÉµtext(12, \"Fecha Pr\\u00E9stamo\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(13, \"th\");\n    i0.ÉµÉµtext(14, \"Fecha L\\u00EDmite\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(15, \"th\");\n    i0.ÉµÉµtext(16, \"D\\u00EDas Transcurridos\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(17, \"th\");\n    i0.ÉµÉµtext(18, \"D\\u00EDas Restantes\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(19, \"th\");\n    i0.ÉµÉµtext(20, \"Estado\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(21, \"th\");\n    i0.ÉµÉµtext(22, \"D\\u00EDas Retraso\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(23, \"th\");\n    i0.ÉµÉµtext(24, \"Multa\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(25, \"th\");\n    i0.ÉµÉµtext(26, \"Acciones\");\n    i0.ÉµÉµelementEnd()()();\n    i0.ÉµÉµelementStart(27, \"tbody\");\n    i0.ÉµÉµtemplate(28, AdminPrestamosComponent_div_44_tr_28_Template, 39, 21, \"tr\", 35);\n    i0.ÉµÉµelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(28);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r1.filtrarPrestamos());\n  }\n}\nexport let AdminPrestamosComponent = /*#__PURE__*/(() => {\n  class AdminPrestamosComponent {\n    authService;\n    adminService;\n    alertService;\n    router;\n    prestamosTable;\n    prestamos = [];\n    loading = false;\n    filtroEstado = 'TODOS'; // TODOS, PRESTADO, MULTA, DEVUELTO\n    constructor(authService, adminService, alertService, router) {\n      this.authService = authService;\n      this.adminService = adminService;\n      this.alertService = alertService;\n      this.router = router;\n    }\n    ngOnInit() {\n      if (!this.authService.isAdmin()) {\n        this.alertService.error('Sin permisos', 'No tienes permisos para acceder a esta secciÃ³n. Debes ser ADMIN.').then(() => {\n          this.router.navigate(['/']);\n        });\n        return;\n      }\n      this.cargarPrestamos();\n    }\n    ngAfterViewInit() {\n      // DataTable se inicializarÃ¡ despuÃ©s de cargar los datos\n    }\n    cargarPrestamos() {\n      // Debug: Verificar estado de autenticaciÃ³n\n      console.log('ðŸ” Estado de autenticaciÃ³n:', {\n        isLoggedIn: this.authService.isLoggedIn(),\n        isAdmin: this.authService.isAdmin(),\n        rol: this.authService.getRol(),\n        username: this.authService.getUsername(),\n        token: this.authService.getToken() ? 'Presente' : 'Ausente'\n      });\n      if (!this.authService.isLoggedIn()) {\n        this.alertService.warning('SesiÃ³n requerida', 'Debes iniciar sesiÃ³n para acceder a esta secciÃ³n.').then(() => {\n          this.router.navigate(['/login']);\n        });\n        return;\n      }\n      if (!this.authService.isAdmin()) {\n        const rolActual = this.authService.getRol();\n        console.error('âŒ Usuario no es ADMIN. Rol actual:', rolActual);\n        this.alertService.error('Sin permisos', `No tienes permisos para acceder a esta secciÃ³n. Debes ser ADMIN.\\n\\nTu rol actual: ${rolActual || 'No definido'}\\n\\nPor favor, inicia sesiÃ³n con un usuario ADMIN.`).then(() => {\n          this.router.navigate(['/']);\n        });\n        return;\n      }\n      this.loading = true;\n      console.log('ðŸ“¡ Solicitando prÃ©stamos desde: http://localhost:8080/api/admin/prestamos');\n      this.adminService.listarPrestamos().subscribe({\n        next: prestamos => {\n          console.log('âœ… PrÃ©stamos cargados exitosamente:', prestamos.length, 'prÃ©stamos');\n          this.prestamos = prestamos;\n          this.loading = false;\n          setTimeout(() => this.inicializarDataTable(), 100);\n        },\n        error: err => {\n          console.error('âŒ Error al cargar prÃ©stamos:', err);\n          console.error('Detalles del error:', {\n            status: err.status,\n            statusText: err.statusText,\n            url: err.url,\n            message: err?.error?.message || err.message\n          });\n          this.loading = false;\n          this.prestamos = []; // Limpiar datos en caso de error\n          if (err.status === 403) {\n            const rolActual = this.authService.getRol();\n            const username = this.authService.getUsername();\n            console.error('âŒ Error 403 - Sin permisos:', {\n              rolActual,\n              username,\n              tokenPresente: !!this.authService.getToken()\n            });\n            if (rolActual === 'ADMIN') {\n              this.alertService.error('Error de autorizaciÃ³n', `Tu token puede haber expirado o tu cuenta puede estar bloqueada.\\n\\nUsuario: ${username || 'No definido'}\\nRol: ${rolActual || 'No definido'}\\n\\nSoluciÃ³n: Cierra sesiÃ³n e inicia sesiÃ³n nuevamente.`);\n            } else {\n              this.alertService.error('Sin permisos', `Debes ser ADMIN para ver los prÃ©stamos.\\n\\nTu rol actual: ${rolActual || 'No definido'}\\nUsuario: ${username || 'No definido'}\\n\\nPor favor, inicia sesiÃ³n con un usuario ADMIN.`).then(() => {\n                this.router.navigate(['/']);\n              });\n            }\n          } else if (err.status === 401) {\n            this.alertService.warning('SesiÃ³n expirada', 'Tu sesiÃ³n ha expirado. Por favor, inicia sesiÃ³n nuevamente.').then(() => {\n              this.authService.logout();\n              this.router.navigate(['/login']);\n            });\n          } else {\n            this.alertService.error('Error al cargar prÃ©stamos', `${err?.error?.message || err.message || 'Error desconocido'}\\n\\nStatus: ${err.status || 'N/A'}`);\n          }\n        }\n      });\n    }\n    inicializarDataTable() {\n      if (this.prestamosTable && this.prestamosTable.nativeElement) {\n        if ($.fn.DataTable.isDataTable(this.prestamosTable.nativeElement)) {\n          $(this.prestamosTable.nativeElement).DataTable().destroy();\n        }\n        $(this.prestamosTable.nativeElement).DataTable({\n          language: {\n            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'\n          },\n          pageLength: 10,\n          order: [[0, 'desc']],\n          // Ordenar por ID descendente (mÃ¡s recientes primero)\n          columnDefs: [{\n            orderable: false,\n            targets: [8]\n          } // Botones de acciÃ³n no ordenables\n          ]\n        });\n      }\n    }\n    recibirLibro(prestamo) {\n      if (!this.authService.isAdmin()) {\n        this.alertService.error('Sin permisos', 'No tienes permisos para realizar esta acciÃ³n. Debes ser ADMIN.');\n        return;\n      }\n      this.alertService.confirm('Confirmar recepciÃ³n', `Â¿Confirmas que recibiste el libro \"${prestamo.libro.titulo}\" de ${prestamo.usuario.nombre} ${prestamo.usuario.apellido}?`, 'SÃ­, recibido', 'Cancelar').then(confirmed => {\n        if (confirmed) {\n          this.adminService.recibirLibro(prestamo.id).subscribe({\n            next: () => {\n              this.cargarPrestamos();\n              this.alertService.success('Libro recibido', 'El libro ha sido recibido exitosamente.');\n            },\n            error: err => {\n              console.error('Error al recibir libro:', err);\n              if (err.status === 403 || err.status === 401) {\n                this.alertService.warning('SesiÃ³n expirada', 'Tu sesiÃ³n ha expirado. Por favor, inicia sesiÃ³n nuevamente.').then(() => {\n                  this.authService.logout();\n                  this.router.navigate(['/login']);\n                });\n              } else {\n                this.alertService.error('Error', `Error al recibir el libro: ${err?.error?.message || 'Error desconocido'}`);\n              }\n            }\n          });\n        }\n      });\n    }\n    actualizarMultas() {\n      console.log('ðŸ”„ Iniciando actualizaciÃ³n de multas...');\n      if (!this.authService.isLoggedIn()) {\n        console.error('âŒ Usuario no estÃ¡ logueado');\n        this.alertService.warning('SesiÃ³n requerida', 'Debes iniciar sesiÃ³n para realizar esta acciÃ³n.').then(() => {\n          this.router.navigate(['/login']);\n        });\n        return;\n      }\n      if (!this.authService.isAdmin()) {\n        const rolActual = this.authService.getRol();\n        console.error('âŒ Usuario no es ADMIN. Rol actual:', rolActual);\n        this.alertService.error('Sin permisos', `No tienes permisos para realizar esta acciÃ³n. Debes ser ADMIN.\\n\\nTu rol actual: ${rolActual || 'No definido'}`);\n        return;\n      }\n      const token = this.authService.getToken();\n      console.log('ðŸ” Token presente:', !!token);\n      console.log('ðŸ” Rol en localStorage:', this.authService.getRol());\n      this.alertService.confirm('Actualizar multas', 'Â¿Deseas actualizar las multas de todos los prÃ©stamos vencidos? Esto calcularÃ¡ las multas de $5,000 por dÃ­a de retraso.', 'SÃ­, actualizar', 'Cancelar').then(confirmed => {\n        if (!confirmed) {\n          console.log('âŒ Usuario cancelÃ³ la actualizaciÃ³n de multas');\n          return;\n        }\n        console.log('ðŸ“¡ Enviando peticiÃ³n PUT a /api/admin/prestamos/actualizar-multas');\n        this.adminService.actualizarMultas().subscribe({\n          next: response => {\n            console.log('âœ… Multas actualizadas exitosamente:', response);\n            this.cargarPrestamos();\n            this.alertService.success('Multas actualizadas', response || 'Las multas han sido actualizadas exitosamente.');\n          },\n          error: err => {\n            console.error('âŒ Error al actualizar multas:', err);\n            console.error('Detalles del error:', {\n              status: err.status,\n              statusText: err.statusText,\n              url: err.url,\n              message: err?.error?.message || err.message,\n              headers: err.headers\n            });\n            if (err.status === 403) {\n              const rolActual = this.authService.getRol();\n              const username = this.authService.getUsername();\n              console.error('âŒ Error 403 - Detalles:', {\n                rolActual,\n                username,\n                tokenPresente: !!this.authService.getToken(),\n                url: err.url\n              });\n              if (rolActual === 'ADMIN') {\n                this.alertService.error('Error de autorizaciÃ³n', `Tu token puede haber expirado o tu cuenta puede estar bloqueada.\\n\\nUsuario: ${username || 'No definido'}\\nRol: ${rolActual || 'No definido'}\\n\\nSoluciÃ³n: Cierra sesiÃ³n e inicia sesiÃ³n nuevamente.`);\n              } else {\n                this.alertService.error('Sin permisos', `Debes ser ADMIN para actualizar multas.\\n\\nTu rol actual: ${rolActual || 'No definido'}\\nUsuario: ${username || 'No definido'}`);\n              }\n            } else if (err.status === 401) {\n              this.alertService.warning('SesiÃ³n expirada', 'Tu sesiÃ³n ha expirado. Por favor, inicia sesiÃ³n nuevamente.').then(() => {\n                this.authService.logout();\n                this.router.navigate(['/login']);\n              });\n            } else {\n              this.alertService.error('Error al actualizar multas', `${err?.error?.message || err.message || 'Error desconocido'}\\n\\nStatus: ${err.status || 'N/A'}`);\n            }\n          }\n        });\n      });\n    }\n    pagarMulta(prestamo) {\n      if (!this.authService.isAdmin()) {\n        this.alertService.error('Sin permisos', 'No tienes permisos para realizar esta acciÃ³n. Debes ser ADMIN.');\n        return;\n      }\n      this.alertService.confirm('Confirmar pago de multa', `Â¿Confirmas que ${prestamo.usuario.nombre} ${prestamo.usuario.apellido} pagÃ³ la multa de ${this.formatearMoneda(prestamo.valorMulta)}?`, 'SÃ­, pagado', 'Cancelar').then(confirmed => {\n        if (confirmed) {\n          this.adminService.pagarMulta(prestamo.id).subscribe({\n            next: () => {\n              this.cargarPrestamos();\n              this.alertService.success('Multa pagada', 'La multa ha sido marcada como pagada exitosamente.');\n            },\n            error: err => {\n              console.error('Error al pagar multa:', err);\n              if (err.status === 403 || err.status === 401) {\n                this.alertService.warning('SesiÃ³n expirada', 'Tu sesiÃ³n ha expirado. Por favor, inicia sesiÃ³n nuevamente.').then(() => {\n                  this.authService.logout();\n                  this.router.navigate(['/login']);\n                });\n              } else {\n                this.alertService.error('Error', `Error al pagar la multa: ${err?.error?.message || 'Error desconocido'}`);\n              }\n            }\n          });\n        }\n      });\n    }\n    calcularDiasTranscurridos(fechaPrestamo) {\n      const fecha = new Date(fechaPrestamo);\n      const hoy = new Date();\n      const diffTime = Math.abs(hoy.getTime() - fecha.getTime());\n      return Math.floor(diffTime / (1000 * 60 * 60 * 24));\n    }\n    calcularDiasRestantes(fechaLimite) {\n      const fecha = new Date(fechaLimite);\n      const hoy = new Date();\n      const diffTime = fecha.getTime() - hoy.getTime();\n      return Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    }\n    estaVencido(fechaLimite) {\n      return this.calcularDiasRestantes(fechaLimite) < 0;\n    }\n    getEstadoBadgeClass(estado) {\n      switch (estado) {\n        case 'PRESTADO':\n          return 'bg-primary';\n        case 'MULTA':\n          return 'bg-danger';\n        case 'DEVUELTO':\n          return 'bg-success';\n        default:\n          return 'bg-secondary';\n      }\n    }\n    getEstadoTexto(estado) {\n      switch (estado) {\n        case 'PRESTADO':\n          return 'Prestado';\n        case 'MULTA':\n          return 'En Multa';\n        case 'DEVUELTO':\n          return 'Devuelto';\n        default:\n          return estado;\n      }\n    }\n    formatearFecha(fecha) {\n      if (!fecha) return 'N/A';\n      return new Date(fecha).toLocaleDateString('es-ES', {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric'\n      });\n    }\n    formatearMoneda(valor) {\n      if (!valor) return '$0';\n      return '$' + valor.toLocaleString('es-CO');\n    }\n    aplicarFiltro() {\n      // Reinicializar DataTable con los datos filtrados\n      setTimeout(() => this.inicializarDataTable(), 100);\n    }\n    filtrarPrestamos() {\n      if (this.filtroEstado === 'TODOS') {\n        return this.prestamos;\n      }\n      return this.prestamos.filter(p => p.estado === this.filtroEstado);\n    }\n    getTotalPrestamos() {\n      return this.prestamos.length;\n    }\n    getPrestadosCount() {\n      return this.prestamos.filter(p => p.estado === 'PRESTADO').length;\n    }\n    getMultasCount() {\n      return this.prestamos.filter(p => p.estado === 'MULTA').length;\n    }\n    getDevueltosCount() {\n      return this.prestamos.filter(p => p.estado === 'DEVUELTO').length;\n    }\n    getDiasRestantesClass(fechaLimite) {\n      return this.calcularDiasRestantes(fechaLimite) < 0 ? 'bg-danger' : 'bg-success';\n    }\n    estaVencidoYEnPrestamo(prestamo) {\n      return this.estaVencido(prestamo.fechaLimite) && prestamo.estado === 'PRESTADO';\n    }\n    tieneDiasRetraso(prestamo) {\n      return prestamo.diasRetraso !== undefined && prestamo.diasRetraso !== null && prestamo.diasRetraso > 0;\n    }\n    tieneMulta(prestamo) {\n      return prestamo.valorMulta !== undefined && prestamo.valorMulta !== null && prestamo.valorMulta > 0;\n    }\n    estaDevuelto(prestamo) {\n      return prestamo.estado === 'DEVUELTO';\n    }\n    estaEnMultaConValor(prestamo) {\n      return prestamo.estado === 'MULTA' && this.tieneMulta(prestamo);\n    }\n    static Éµfac = function AdminPrestamosComponent_Factory(t) {\n      return new (t || AdminPrestamosComponent)(i0.ÉµÉµdirectiveInject(i1.AuthService), i0.ÉµÉµdirectiveInject(i2.AdminService), i0.ÉµÉµdirectiveInject(i3.AlertService), i0.ÉµÉµdirectiveInject(i4.Router));\n    };\n    static Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n      type: AdminPrestamosComponent,\n      selectors: [[\"app-admin-prestamos\"]],\n      viewQuery: function AdminPrestamosComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ÉµÉµviewQuery(_c0, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ÉµÉµqueryRefresh(_t = i0.ÉµÉµloadQuery()) && (ctx.prestamosTable = _t.first);\n        }\n      },\n      decls: 45,\n      vars: 8,\n      consts: [[\"prestamosTable\", \"\"], [1, \"admin-container\"], [1, \"container-fluid\", \"py-4\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-4\"], [1, \"page-title\", \"mb-2\"], [1, \"text-muted\"], [1, \"btn\", \"btn-warning\", \"me-2\", 3, \"click\"], [1, \"card\", \"shadow-sm\", \"mb-4\"], [1, \"card-body\"], [1, \"row\", \"align-items-center\"], [1, \"col-md-3\"], [1, \"form-label\"], [1, \"form-select\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [\"value\", \"TODOS\"], [\"value\", \"PRESTADO\"], [\"value\", \"MULTA\"], [\"value\", \"DEVUELTO\"], [1, \"col-md-9\"], [1, \"d-flex\", \"gap-2\", \"flex-wrap\"], [1, \"badge\", \"bg-primary\"], [1, \"badge\", \"bg-danger\"], [1, \"badge\", \"bg-success\"], [1, \"card\", \"shadow-sm\"], [1, \"card-header\", \"bg-warning\", \"text-dark\"], [1, \"mb-0\"], [\"class\", \"text-center py-5\", 4, \"ngIf\"], [\"class\", \"table-responsive\", 4, \"ngIf\"], [1, \"text-center\", \"py-5\"], [\"role\", \"status\", 1, \"spinner-border\", \"text-warning\"], [1, \"visually-hidden\"], [\"role\", \"alert\", 1, \"alert\", \"alert-warning\"], [1, \"alert-heading\"], [1, \"table-responsive\"], [\"id\", \"prestamosTable\", 1, \"table\", \"table-striped\", \"table-hover\"], [1, \"table-dark\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"badge bg-danger ms-1\", 4, \"ngIf\"], [1, \"badge\", \"bg-info\"], [1, \"badge\", 3, \"ngClass\"], [\"class\", \"badge bg-danger\", 4, \"ngIf\"], [\"class\", \"text-muted\", 4, \"ngIf\"], [\"class\", \"text-danger\", 4, \"ngIf\"], [\"class\", \"btn btn-sm btn-success me-1\", \"title\", \"Recibir libro\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"btn btn-sm btn-primary\", \"title\", \"Pagar multa\", 3, \"click\", 4, \"ngIf\"], [1, \"badge\", \"bg-danger\", \"ms-1\"], [1, \"text-danger\"], [\"title\", \"Recibir libro\", 1, \"btn\", \"btn-sm\", \"btn-success\", \"me-1\", 3, \"click\"], [\"title\", \"Pagar multa\", 1, \"btn\", \"btn-sm\", \"btn-primary\", 3, \"click\"]],\n      template: function AdminPrestamosComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ÉµÉµelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 3)(3, \"div\")(4, \"h1\", 4);\n          i0.ÉµÉµtext(5, \" \\uD83D\\uDCD6 Gesti\\u00F3n de Pr\\u00E9stamos \");\n          i0.ÉµÉµelementEnd();\n          i0.ÉµÉµelementStart(6, \"p\", 5);\n          i0.ÉµÉµtext(7, \"Administra los pr\\u00E9stamos de libros y multas\");\n          i0.ÉµÉµelementEnd()();\n          i0.ÉµÉµelementStart(8, \"div\")(9, \"button\", 6);\n          i0.ÉµÉµlistener(\"click\", function AdminPrestamosComponent_Template_button_click_9_listener() {\n            return ctx.actualizarMultas();\n          });\n          i0.ÉµÉµtext(10, \" \\uD83D\\uDD04 Actualizar Multas \");\n          i0.ÉµÉµelementEnd()()();\n          i0.ÉµÉµelementStart(11, \"div\", 7)(12, \"div\", 8)(13, \"div\", 9)(14, \"div\", 10)(15, \"label\", 11)(16, \"strong\");\n          i0.ÉµÉµtext(17, \"Filtrar por Estado:\");\n          i0.ÉµÉµelementEnd()();\n          i0.ÉµÉµelementStart(18, \"select\", 12);\n          i0.ÉµÉµtwoWayListener(\"ngModelChange\", function AdminPrestamosComponent_Template_select_ngModelChange_18_listener($event) {\n            i0.ÉµÉµtwoWayBindingSet(ctx.filtroEstado, $event) || (ctx.filtroEstado = $event);\n            return $event;\n          });\n          i0.ÉµÉµlistener(\"change\", function AdminPrestamosComponent_Template_select_change_18_listener() {\n            return ctx.aplicarFiltro();\n          });\n          i0.ÉµÉµelementStart(19, \"option\", 13);\n          i0.ÉµÉµtext(20, \"Todos\");\n          i0.ÉµÉµelementEnd();\n          i0.ÉµÉµelementStart(21, \"option\", 14);\n          i0.ÉµÉµtext(22, \"Prestados\");\n          i0.ÉµÉµelementEnd();\n          i0.ÉµÉµelementStart(23, \"option\", 15);\n          i0.ÉµÉµtext(24, \"En Multa\");\n          i0.ÉµÉµelementEnd();\n          i0.ÉµÉµelementStart(25, \"option\", 16);\n          i0.ÉµÉµtext(26, \"Devueltos\");\n          i0.ÉµÉµelementEnd()()();\n          i0.ÉµÉµelementStart(27, \"div\", 17)(28, \"div\", 18)(29, \"span\", 19);\n          i0.ÉµÉµtext(30);\n          i0.ÉµÉµelementEnd();\n          i0.ÉµÉµelementStart(31, \"span\", 19);\n          i0.ÉµÉµtext(32);\n          i0.ÉµÉµelementEnd();\n          i0.ÉµÉµelementStart(33, \"span\", 20);\n          i0.ÉµÉµtext(34);\n          i0.ÉµÉµelementEnd();\n          i0.ÉµÉµelementStart(35, \"span\", 21);\n          i0.ÉµÉµtext(36);\n          i0.ÉµÉµelementEnd()()()()()();\n          i0.ÉµÉµelementStart(37, \"div\", 22)(38, \"div\", 23)(39, \"h5\", 24);\n          i0.ÉµÉµtext(40, \" \\uD83D\\uDCD6 Lista de Pr\\u00E9stamos \");\n          i0.ÉµÉµelementEnd()();\n          i0.ÉµÉµelementStart(41, \"div\", 8);\n          i0.ÉµÉµtemplate(42, AdminPrestamosComponent_div_42_Template, 4, 0, \"div\", 25)(43, AdminPrestamosComponent_div_43_Template, 6, 0, \"div\", 25)(44, AdminPrestamosComponent_div_44_Template, 29, 1, \"div\", 26);\n          i0.ÉµÉµelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ÉµÉµadvance(18);\n          i0.ÉµÉµtwoWayProperty(\"ngModel\", ctx.filtroEstado);\n          i0.ÉµÉµadvance(12);\n          i0.ÉµÉµtextInterpolate1(\"Total: \", ctx.getTotalPrestamos(), \"\");\n          i0.ÉµÉµadvance(2);\n          i0.ÉµÉµtextInterpolate1(\"Prestados: \", ctx.getPrestadosCount(), \"\");\n          i0.ÉµÉµadvance(2);\n          i0.ÉµÉµtextInterpolate1(\"En Multa: \", ctx.getMultasCount(), \"\");\n          i0.ÉµÉµadvance(2);\n          i0.ÉµÉµtextInterpolate1(\"Devueltos: \", ctx.getDevueltosCount(), \"\");\n          i0.ÉµÉµadvance(6);\n          i0.ÉµÉµproperty(\"ngIf\", ctx.loading);\n          i0.ÉµÉµadvance();\n          i0.ÉµÉµproperty(\"ngIf\", !ctx.loading && ctx.prestamos.length === 0);\n          i0.ÉµÉµadvance();\n          i0.ÉµÉµproperty(\"ngIf\", !ctx.loading && ctx.prestamos.length > 0);\n        }\n      },\n      dependencies: [i5.NgClass, i5.NgForOf, i5.NgIf, i6.NgSelectOption, i6.ÉµNgSelectMultipleOption, i6.SelectControlValueAccessor, i6.NgControlStatus, i6.NgModel],\n      styles: [\".admin-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#eff6ff,#dbeafe,#bfdbfe);padding:20px 0}.page-title[_ngcontent-%COMP%]{color:var(--color-dark);font-weight:700;font-size:2rem;text-shadow:0 2px 4px rgba(30,58,138,.1)}.card[_ngcontent-%COMP%]{border-radius:1rem;border:none;box-shadow:0 4px 6px #2563eb26;transition:transform .2s,box-shadow .2s;background:#fff;border:1px solid rgba(37,99,235,.1)}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 16px #2563eb40;border-color:var(--color-primary)}.card-header[_ngcontent-%COMP%]{border-radius:1rem 1rem 0 0!important;font-weight:600;background:linear-gradient(90deg,#f59e0b,#d97706)!important}.table[_ngcontent-%COMP%]{margin-bottom:0}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:2px solid #f59e0b;font-weight:600;text-transform:uppercase;font-size:.85rem;letter-spacing:.5px;background:linear-gradient(180deg,#f59e0b,#d97706);color:#fff}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--color-light-2)}.btn[_ngcontent-%COMP%]{border-radius:.5rem;font-weight:500;transition:all .2s}.btn-warning[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f59e0b,#d97706);border:none;color:#fff}.btn-warning[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 12px #f59e0b66;background:linear-gradient(90deg,#d97706,#b45309);color:#fff}.btn-success[_ngcontent-%COMP%]{background:linear-gradient(90deg,#10b981,#059669);border:none;color:#fff}.btn-success[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 12px #10b98166;background:linear-gradient(90deg,#059669,#047857);color:#fff}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--color-primary),var(--color-secondary));border:none}.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 12px #2563eb66;background:linear-gradient(90deg,var(--color-secondary),var(--color-accent))}.badge[_ngcontent-%COMP%]{padding:.35em .65em;font-weight:500}.badge.bg-primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--color-primary),var(--color-secondary))!important}.badge.bg-danger[_ngcontent-%COMP%]{background:linear-gradient(90deg,#ef4444,#dc2626)!important}.badge.bg-success[_ngcontent-%COMP%]{background:linear-gradient(90deg,#10b981,#059669)!important}.badge.bg-info[_ngcontent-%COMP%]{background:linear-gradient(90deg,#0ea5e9,#0284c7)!important}.dataTables_wrapper[_ngcontent-%COMP%]{padding-top:1rem}.dataTables_filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid var(--color-accent);padding:.5rem;transition:all .2s}.dataTables_filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#f59e0b;box-shadow:0 0 0 .2rem #f59e0b40;outline:none}.dataTables_length[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid var(--color-accent);padding:.5rem;transition:all .2s}.dataTables_length[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#f59e0b;box-shadow:0 0 0 .2rem #f59e0b40;outline:none}.form-select[_ngcontent-%COMP%]:focus{border-color:#f59e0b;box-shadow:0 0 0 .2rem #f59e0b40}@media (max-width: 768px){.page-title[_ngcontent-%COMP%]{font-size:1.5rem}.table-responsive[_ngcontent-%COMP%]{font-size:.9rem}}\"]\n    });\n  }\n  return AdminPrestamosComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}