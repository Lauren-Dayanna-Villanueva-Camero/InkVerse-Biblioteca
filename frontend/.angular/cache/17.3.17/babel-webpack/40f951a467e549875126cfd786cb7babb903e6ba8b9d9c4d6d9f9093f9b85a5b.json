{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/auth.service\";\nimport * as i2 from \"../../services/admin.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/common\";\nconst _c0 = [\"librosTable\"];\nfunction AdminComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"form\", 13);\n    i0.ɵɵlistener(\"ngSubmit\", function AdminComponent_div_14_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.crearAdmin());\n    });\n    i0.ɵɵelementStart(2, \"div\", 1)(3, \"div\", 14)(4, \"label\", 15);\n    i0.ɵɵtext(5, \"Usuario\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"input\", 16);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_div_14_Template_input_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.formAdmin.username, $event) || (ctx_r1.formAdmin.username = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 14)(8, \"label\", 15);\n    i0.ɵɵtext(9, \"Contrase\\u00F1a\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"input\", 17);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_div_14_Template_input_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.formAdmin.password, $event) || (ctx_r1.formAdmin.password = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 14)(12, \"label\", 15);\n    i0.ɵɵtext(13, \"Nombre\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"input\", 18);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_div_14_Template_input_ngModelChange_14_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.formAdmin.nombre, $event) || (ctx_r1.formAdmin.nombre = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"div\", 14)(16, \"label\", 15);\n    i0.ɵɵtext(17, \"Apellido\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"input\", 19);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_div_14_Template_input_ngModelChange_18_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.formAdmin.apellido, $event) || (ctx_r1.formAdmin.apellido = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(19, \"div\", 20)(20, \"label\", 15);\n    i0.ɵɵtext(21, \"Email\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"input\", 21);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_div_14_Template_input_ngModelChange_22_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.formAdmin.email, $event) || (ctx_r1.formAdmin.email = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(23, \"button\", 22);\n    i0.ɵɵtext(24, \" Crear Administrador \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.formAdmin.username);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.formAdmin.password);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.formAdmin.nombre);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.formAdmin.apellido);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.formAdmin.email);\n  }\n}\nexport let AdminComponent = /*#__PURE__*/(() => {\n  class AdminComponent {\n    authService;\n    adminService;\n    router;\n    fb;\n    librosTable;\n    libros = [];\n    categorias = [];\n    loading = false;\n    mostrarFormularioLibro = false;\n    modoEdicion = false;\n    libroSeleccionado = null;\n    libroForm;\n    categoriaForm;\n    mostrarFormularioCategoria = false;\n    constructor(authService, adminService, router, fb) {\n      this.authService = authService;\n      this.adminService = adminService;\n      this.router = router;\n      this.fb = fb;\n      this.libroForm = this.fb.group({\n        titulo: ['', Validators.required],\n        autor: ['', Validators.required],\n        descripcion: ['', Validators.required],\n        imagenUrl: [''],\n        cantidadTotal: [1, [Validators.required, Validators.min(1)]],\n        cantidadDisponible: [1, [Validators.required, Validators.min(0)]],\n        categoriaId: [null]\n      });\n      this.categoriaForm = this.fb.group({\n        nombre: ['', Validators.required]\n      });\n    }\n    ngOnInit() {\n      if (!this.authService.isAdmin()) {\n        this.router.navigate(['/']);\n        return;\n      }\n      this.cargarCategorias();\n      this.cargarLibros();\n    }\n    ngAfterViewInit() {\n      // DataTable se inicializará después de cargar los datos\n    }\n    cargarCategorias() {\n      this.adminService.listarCategorias().subscribe({\n        next: categorias => {\n          this.categorias = categorias;\n        },\n        error: err => {\n          console.error('Error al cargar categorías:', err);\n        }\n      });\n    }\n    cargarLibros() {\n      this.loading = true;\n      this.adminService.listarLibros().subscribe({\n        next: libros => {\n          this.libros = libros;\n          this.loading = false;\n          setTimeout(() => this.inicializarDataTable(), 100);\n        },\n        error: err => {\n          console.error('Error al cargar libros:', err);\n          this.loading = false;\n        }\n      });\n    }\n    inicializarDataTable() {\n      if ($.fn.DataTable.isDataTable(this.librosTable.nativeElement)) {\n        $(this.librosTable.nativeElement).DataTable().destroy();\n      }\n      $(this.librosTable.nativeElement).DataTable({\n        language: {\n          url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'\n        },\n        pageLength: 10,\n        order: [[0, 'asc']],\n        columnDefs: [{\n          orderable: false,\n          targets: [6, 7]\n        } // Botones de acción no ordenables\n        ]\n      });\n    }\n    abrirCrearLibro() {\n      this.modoEdicion = false;\n      this.libroSeleccionado = null;\n      this.libroForm.reset({\n        cantidadTotal: 1,\n        cantidadDisponible: 1\n      });\n      this.mostrarFormularioLibro = true;\n      const modal = new bootstrap.Modal(document.getElementById('libroModal'));\n      modal.show();\n    }\n    abrirEditarLibro(libro) {\n      this.modoEdicion = true;\n      this.libroSeleccionado = libro;\n      this.libroForm.patchValue({\n        titulo: libro.titulo,\n        autor: libro.autor,\n        descripcion: libro.descripcion,\n        imagenUrl: libro.imagenUrl || '',\n        cantidadTotal: libro.cantidadTotal,\n        cantidadDisponible: libro.cantidadDisponible,\n        categoriaId: libro.categoria?.id || null\n      });\n      this.mostrarFormularioLibro = true;\n      const modal = new bootstrap.Modal(document.getElementById('libroModal'));\n      modal.show();\n    }\n    guardarLibro() {\n      if (this.libroForm.invalid) {\n        this.libroForm.markAllAsTouched();\n        return;\n      }\n      const formValue = this.libroForm.value;\n      const libro = {\n        id: this.libroSeleccionado?.id || 0,\n        titulo: formValue.titulo,\n        autor: formValue.autor,\n        descripcion: formValue.descripcion,\n        imagenUrl: formValue.imagenUrl || 'https://via.placeholder.com/300x220?text=Libro',\n        cantidadTotal: formValue.cantidadTotal,\n        cantidadDisponible: formValue.cantidadDisponible,\n        categoria: formValue.categoriaId ? this.categorias.find(c => c.id === formValue.categoriaId) : undefined\n      };\n      const operacion = this.modoEdicion ? this.adminService.actualizarLibro(libro.id, libro) : this.adminService.crearLibro(libro);\n      operacion.subscribe({\n        next: () => {\n          this.cerrarModal();\n          this.cargarLibros();\n          alert(this.modoEdicion ? 'Libro actualizado exitosamente' : 'Libro creado exitosamente');\n        },\n        error: err => {\n          alert(err?.error?.message || 'Error al guardar el libro');\n        }\n      });\n    }\n    eliminarLibro(libro) {\n      if (!confirm(`¿Estás seguro de eliminar el libro \"${libro.titulo}\"?`)) {\n        return;\n      }\n      this.adminService.eliminarLibro(libro.id).subscribe({\n        next: () => {\n          this.cargarLibros();\n          alert('Libro eliminado exitosamente');\n        },\n        error: err => {\n          alert(err?.error?.message || 'Error al eliminar el libro');\n        }\n      });\n    }\n    cerrarModal() {\n      const modal = bootstrap.Modal.getInstance(document.getElementById('libroModal'));\n      if (modal) {\n        modal.hide();\n      }\n      this.mostrarFormularioLibro = false;\n      this.libroForm.reset();\n    }\n    crearCategoria() {\n      if (this.categoriaForm.invalid) {\n        this.categoriaForm.markAllAsTouched();\n        return;\n      }\n      const categoria = {\n        id: 0,\n        nombre: this.categoriaForm.value.nombre\n      };\n      this.adminService.crearCategoria(categoria).subscribe({\n        next: () => {\n          this.categoriaForm.reset();\n          this.mostrarFormularioCategoria = false;\n          this.cargarCategorias();\n          alert('Categoría creada exitosamente');\n        },\n        error: err => {\n          alert(err?.error?.message || 'Error al crear la categoría');\n        }\n      });\n    }\n    static ɵfac = function AdminComponent_Factory(t) {\n      return new (t || AdminComponent)(i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i2.AdminService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.FormBuilder));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AdminComponent,\n      selectors: [[\"app-admin\"]],\n      viewQuery: function AdminComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.librosTable = _t.first);\n        }\n      },\n      decls: 32,\n      vars: 2,\n      consts: [[1, \"container\", \"my-5\"], [1, \"row\"], [1, \"col-12\"], [1, \"page-title\", \"mb-4\"], [1, \"card\", \"shadow-sm\", \"mb-4\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"mb-0\"], [1, \"card-body\"], [1, \"text-muted\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [\"class\", \"mt-4\", 4, \"ngIf\"], [1, \"alert\", \"alert-info\"], [1, \"mt-4\"], [3, \"ngSubmit\"], [1, \"col-md-6\", \"mb-3\"], [1, \"form-label\"], [\"type\", \"text\", \"name\", \"username\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"password\", \"name\", \"password\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"text\", \"name\", \"nombre\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"text\", \"name\", \"apellido\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"ngModel\"], [1, \"col-md-12\", \"mb-3\"], [\"type\", \"email\", \"name\", \"email\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"submit\", 1, \"btn\", \"btn-success\"]],\n      template: function AdminComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h1\", 3);\n          i0.ɵɵtext(4, \"Panel de Administraci\\u00F3n\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"div\", 4)(6, \"div\", 5)(7, \"h5\", 6);\n          i0.ɵɵtext(8, \"Crear Primer Administrador\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(9, \"div\", 7)(10, \"p\", 8);\n          i0.ɵɵtext(11, \" Si no existe ning\\u00FAn administrador en el sistema, puedes crear el primero aqu\\u00ED. Una vez creado, solo los administradores podr\\u00E1n gestionar el sistema. \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"button\", 9);\n          i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_12_listener() {\n            return ctx.mostrarCrearAdmin = !ctx.mostrarCrearAdmin;\n          });\n          i0.ɵɵtext(13);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(14, AdminComponent_div_14_Template, 25, 5, \"div\", 10);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(15, \"div\", 11)(16, \"h5\");\n          i0.ɵɵtext(17, \"Funcionalidades de Administrador:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(18, \"ul\")(19, \"li\");\n          i0.ɵɵtext(20, \"Gesti\\u00F3n de categor\\u00EDas de libros\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"li\");\n          i0.ɵɵtext(22, \"Registro y gesti\\u00F3n de libros\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"li\");\n          i0.ɵɵtext(24, \"Seguimiento de pr\\u00E9stamos\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"li\");\n          i0.ɵɵtext(26, \"Ver usuarios con multas\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(27, \"li\");\n          i0.ɵɵtext(28, \"Gesti\\u00F3n de usuarios\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(29, \"p\", 6)(30, \"small\");\n          i0.ɵɵtext(31, \"Estas funcionalidades estar\\u00E1n disponibles pr\\u00F3ximamente a trav\\u00E9s de los endpoints del backend.\");\n          i0.ɵɵelementEnd()()()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(13);\n          i0.ɵɵtextInterpolate1(\" \", ctx.mostrarCrearAdmin ? \"Ocultar\" : \"Mostrar formulario\", \" \");\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.mostrarCrearAdmin);\n        }\n      },\n      dependencies: [i5.NgIf, i4.ɵNgNoValidate, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.RequiredValidator, i4.NgModel, i4.NgForm],\n      styles: [\".card[_ngcontent-%COMP%]{border-radius:1rem}\"]\n    });\n  }\n  return AdminComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}